<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Spiral Editor</title>
	<link rel="stylesheet" type="text/css" href="style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.css">
</head>
<body onload="resetInputs()">
	<div class="warning-modal-full-page" id="warningModal-fullPage">
		<div class="warning-modal">
			<h1>Seizure Warning</h1>
			<p>This website contains flashing images that might trigger seizures for people with photosensitive epilepsy.</p>
			<p>If you have a history of epilepsy or seizures, please avoid this site like the plague.</p>
			<button id="continueButton" onclick="hideWarning(); restartDisplay();">Continue</button>
		</div>
	</div>
	
	
	<div id="hypnoText-container"></div>
	<div id="hypnoText-controls">
        <textarea id="hypnoText-input" placeholder="Enter subliminals here"></textarea>
        <div><input id="hypnoText-delay-input" type="number" min="0" step="0.1" value="1.0"><label style="font-size: 1vh"> Delay (seconds)</label></div>
        <div><input id="hypnoText-space-input" type="number" min="0" step="0.1" value="0.0"><label style="font-size: 1vh"> Spacing (seconds)</label></div>
		<div><input type="range" id="hypnoText-size-input" min="0.5" max="50" step="0.01" value="10" class="slider" style="width: 70%; margin-bottom: 2vh;"><label style="position: absolute; font-size: 1vh; margin-top: -0.1vh; margin-left: 0.2vh;">Size</label></div>
		<input id="hypnoText-color-picker" type="text" value="#ffffff84" data-coloris>
        <button id="hypnoText-randomize-button" type="button_toggle">Randomize Order (currently broken)</button>
    </div>
	
	
	
	
	
	
	<div id="spiral-controls">
		<div class="zero-centered">
			<input type="range" id="globalSpeed" min="-5" max="5" step="0.01" value="1" class="slider-zeroCentered">
			<button onclick="setToZero('globalSpeed')">Φ</button>
			<label for="globalSpeed">Global Speed</label>
		</div>
		<div><input type="range" id="globalScale" min="0.4" max="5" step="0.01" value="1" class="slider"><label for="globalScale">Global Scale</label></div>
		<div id="spacing"></div>
		<div><input type="range" id="freq" min="0" max="60" step="0.1" value="20" class="slider"><label for="freq">Base Frequency</label></div>
		<div class="zero-centered">
			<input type="range" id="baseSpeed" min="-10" max="10" step="0.1" value="5" class="slider-zeroCentered">
			<button onclick="setToZero('baseSpeed')">Φ</button>
			<label for="baseSpeed">Base Speed</label>
		</div>
		<div><input type="range" id="dirFlips" min="0" max="5" step="1" value="5" class="slider"><label for="dirFlips">Direction Flips</label></div>
		<div class="zero-centered">
			<input type="range" id="concentric" min="-10" max="10" step="0.05" value="0" class="slider-zeroCentered">
			<button onclick="setToZero('concentric')">Φ</button>
			<label for="concentric">Concentric</label>
		</div>
		<div class="zero-centered">
			<input type="range" id="concentricSpeed" min="-1" max="1" step="0.002" value="0" class="slider-zeroCentered">
			<button onclick="setToZero('concentricSpeed')">Φ</button>
			<label for="concentric">Concentric Speed</label>
		</div>
		<div id="spacing"></div>
		<div class="zero-centered">
			<input type="range" id="noiseAngAmp" min="-5" max="5" step="0.01" value="0" class="slider-zeroCentered">
			<button onclick="setToZero('noiseAngAmp')">Φ</button>
			<label for="noiseAngAmp">Noise Amplitude (Angle)</label>
		</div>
		<div class="zero-centered">
			<input type="range" id="noiseRadAmp" min="-0.1" max="0.1" step="0.001" value="0" class="slider-zeroCentered">
			<button onclick="setToZero('noiseRadAmp')">Φ</button>
			<label for="noiseRadAmp">Noise Amplitude (Radius)</label>
		</div>
		<div><input type="range" id="noiseFreq" min="0" max="20" step="0.1" value="6" class="slider"><label for="noiseFreq">Noise Frequency</label></div>
		<div class="zero-centered">
			<input type="range" id="noiseSpeed" min="-1" max="1" step="0.01" value="-0.2" class="slider-zeroCentered">
			<button onclick="setToZero('noiseSpeed')">Φ</button>
			<label for="noiseSpeed">Noise Rotation Speed</label>
		</div>
		<div id="spacing"></div>
		<div><input type="range" id="pulseAmp" min="0" max="5" step="0.01" value="2" class="slider"><label for="pulseAmp">Pulse Amplitude</label></div>
		<div><input type="range" id="pulseFreq" min="0" max="20" step="0.1" value="10.6" class="slider"><label for="pulseFreq">Pulse Frequency</label></div>
		<div class="zero-centered">
			<input type="range" id="pulseSpeed" min="-5" max="5" step="0.01" value="1.5" class="slider-zeroCentered">
			<button onclick="setToZero('pulseSpeed')">Φ</button>
			<label for="pulseSpeed">Pulse Speed</label>
		</div>
		<div><input type="range" id="pulseExp" min="0" max="5" step="0.01" value="2" class="slider"><label for="pulseExp">Pulse Exponent</label></div>
		<div id="spacing"></div>
		<div><input type="range" id="hue" min="0" max="1" step="0.01" value="0.7" class="slider"><label for="hue">Hue</label></div>
		<div><input type="range" id="sat" min="0" max="1" step="0.01" value="0.8" class="slider"><label for="sat">Saturation</label></div>
		<div><input type="range" id="val" min="0" max="3" step="0.01" value="1.5" class="slider"><label for="val">Brightness</label></div>
		<div><input type="range" id="lineExp" min="0" max="5" step="0.01" value="3.0" class="slider"><label for="lineExp">Line Feather</label></div>
		<div id="spacing"></div>
		<div><input type="range" id="motionBlur" min="0" max="5" step="0.01" value="0.75" class="slider"><label for="motionBlur">Motion Blur</label></div>
		<div><input type="range" id="superSample" min="1" max="8" step="1" value="4" class="slider"><label for="superSample">Super Sampling Factor (Blur / AA quality)</label></div>
		<div id="spacing"></div>
		<div><button onclick="randomizeSliders()">Randomize</button></div>
		<div><button id="generateBtn">Generate Visualizer</button></div>
		<div id="spacing"></div>
		<div id="fps" style="padding-left: 1vw;"></div>
	</div>
    <button class="fullscreen" id="fullscreenButton" onclick="toggleFullScreen()" style="display: none;">fullscreen</button>
    <canvas id="myCanvas"></canvas>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="spiral.js"></script>
	
	
	
	
	
	<script>
		let timer;
		let isElementHovered = false;

		document.addEventListener('mousemove', () => {
			clearTimeout(timer);
			if (document.fullscreenElement) {
				document.getElementById('fullscreenButton').style.display = 'block';
				document.querySelector('body').style.cursor = 'auto';
				timer = setTimeout(() => {
					document.getElementById('fullscreenButton').style.display = isElementHovered ? 'block' : 'none';
					document.querySelector('body').style.cursor = 'none';
				}, 2000);
			}
		});

		document.getElementById('fullscreenButton').addEventListener('mouseover', () => {
			isElementHovered = true;
		});

		document.getElementById('fullscreenButton').addEventListener('mouseout', () => {
			isElementHovered = false;
		});

		function toggleFullScreen() {
			if (!document.fullscreenElement) {
				document.documentElement.requestFullscreen();
				document.getElementById('fullscreenButton').style.display = 'none';
			} else {
				if (document.exitFullscreen) {
					document.exitFullscreen();
					document.getElementById('fullscreenButton').style.display = 'block';
					document.querySelector('body').style.cursor = 'auto';
					clearTimeout(timer);
				}
			}
		}
	</script>
	
	
	
	
	
	
	<script src="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.js"></script>
    <script>
		Coloris({
			themeMode: 'dark',
			alpha: true,
			defaultColor: '#ffffff84'
		});
		
        let textContainer = document.getElementById("hypnoText-container");
        let textInput = document.getElementById("hypnoText-input");
        let delayInput = document.getElementById("hypnoText-delay-input");
        let spaceInput = document.getElementById("hypnoText-space-input");
        let randomizeButton = document.getElementById("hypnoText-randomize-button");
		let colorInput = document.querySelector('#hypnoText-color-picker');
		let sizeInput = document.querySelector('#hypnoText-size-input');
		

        let textLines = [];
        let currentIndex = 0;
        let delay = 1000; // initialize at default
        let space = 0; // initialize at default
        let intervalId;
        let isRandomized = false;
		
		// add an event listener to the color input field
		colorInput.addEventListener('input', function() {
			// get the hex value from the input field
			let hexValue = this.value;

			// set the color of the div to the hex value
			textContainer.style.color = hexValue;
		});


        // add an event listener to the size input field
        sizeInput.addEventListener('input', function() {
            // get the size value from the input field
            let sizeValue = this.value + 'vh';

            // set the font size of the div to the size value
            textContainer.style.fontSize = sizeValue;
        });
		
		function restartDisplay() {
            currentIndex = 0;
            updateDisplay();
        }

		function updateDisplay() {
			clearTimeout(intervalId); // Clear the previous timeout
			if (textLines.length > 0) {
				setFadeOutInDuration(space * 0.2);
				fadeOut(() => {
					textContainer.textContent = textLines[currentIndex];
					fadeIn(() => {
						currentIndex = (currentIndex + 1) % textLines.length;
						if (currentIndex == 0 && isRandomized) {
							randomizeOrder();
						}
						intervalId = setTimeout(updateDisplay, delay);
					});
				});
			} else {
				textContainer.textContent = "";
			}
		}

		function fadeIn(onComplete) {
			textContainer.classList.remove("text-fade");
			setTimeout(onComplete, space * 1000);
		}

		function fadeOut(onComplete) {
			textContainer.classList.add("text-fade");
			setTimeout(onComplete, space * 1000);
		}

		function setFadeOutInDuration(duration) {
			textContainer.style.transitionDuration = `${duration}s`;
		}

        function randomizeOrder() {
            let lastText = '';
            if (textLines.length > 1 && currentIndex > 0) {
                lastText = textLines[currentIndex - 1];
            }

            let randomOrder;
            do {
                randomOrder = textLines.slice().sort(() => Math.random() - 0.5);
            } while (textLines.length > 1 && randomOrder[0] === lastText);

            textLines = randomOrder;
            updateDisplay();
        }

        function toggleRandomize() {
            isRandomized = !isRandomized;
            randomizeButton.classList.toggle("active", isRandomized);
            if (isRandomized) {
                randomizeOrder();
            } else {
                textLines = textInput.value.split("\n");
                updateDisplay();
            }
        }

        textInput.addEventListener("input", () => {
            textLines = textInput.value.split("\n");
            if (!isRandomized) {
                updateDisplay();
            }
        });

        delayInput.addEventListener("input", () => {
            delay = parseFloat(delayInput.value) * 1000;
            updateDisplay();
        });

        spaceInput.addEventListener("input", () => {
            space = parseFloat(spaceInput.value);
        });

        randomizeButton.addEventListener("click", () => {
            toggleRandomize()
        });

        updateDisplay();
    </script>
	
    <script>
	    function hideWarning() {
			document.getElementById("warningModal-fullPage").style.display = "none";
		}

		function setToZero(id) {
			document.getElementById(id).value = 0;
			document.getElementById(id).dispatchEvent(new Event('input'));
		}
		function resetInputs() {
			document.querySelectorAll("input[type='range']").forEach(function(slider) {
				slider.value = slider.defaultValue;
			});
			document.querySelectorAll("input[type='number']").forEach(function(numField) {
				numField.value = numField.defaultValue;
			});
			document.querySelectorAll("input[type='text']").forEach(function(textfield) {
				textfield.value = "";
			});
			document.querySelectorAll("textarea").forEach(function(textarea) {
				textarea.value = "";
			});
		}
		function randomizeSliders() {
		  document.querySelectorAll("input[type='range']").forEach(function (slider) {
			if (
			  slider.id !== "superSample" &&
			  slider.id !== "globalSpeed" &&
			  slider.id !== "globalScale"
			) {
			let randomValue;

			// Adjust noiseFreq slider value to favor very low numbers
			if (slider.id === "noiseFreq") {
				const randVal = Math.random();
				randomValue = randVal * randVal * randVal * slider.max;
			} else if (Number.isInteger(parseFloat(slider.step))) {
				let range = (slider.max - slider.min) / slider.step;
				let randomIndex = Math.floor(Math.random() * (range + 1));
				randomValue = randomIndex * slider.step + parseFloat(slider.min);
			} else {
				randomValue =
				  Math.random() * (slider.max - slider.min) + parseFloat(slider.min);
				randomValue = randomValue.toFixed(
				  slider.step.toString().split(".")[1].length
			    );
			}

			  // Adjust concentric slider value with 75% chance of being forced to 0 and 25% of randomization
			  if (slider.id === "concentric") {
				const randomPercent = Math.random();
				if (randomPercent < 0.75) {
				  randomValue = 0;
				}
			  }

			  // Adjust dirFlips slider value with 75% chance of being forced to 0 and 25% of randomization
			  if (slider.id === "dirFlips") {
				const randomPercent = Math.random();
				if (randomPercent < 0.25) {
				  randomValue = 0;
				}
			  }

			  
			  // Adjust lineExp slider value with 25% chance of being forced to 0 and 75% of randomization
			  if (slider.id === "lineExp") {
				const randomPercent = Math.random();
				if (randomPercent < 0.25) {
				  randomValue = 0;
				}
			  }
			  
			  

			  slider.value = randomValue;
			  slider.dispatchEvent(new Event("input"));
			}
		  });
		}
		function generateURL() {
			const inputList = [
				{ elementType: 'textarea', inputType: 'textarea', inputId: 'hypnoText-input' },
				{ elementType: 'input', inputType: 'number', inputId: 'hypnoText-delay-input' },
				{ elementType: 'input', inputType: 'number', inputId: 'hypnoText-space-input' },
				{ elementType: 'input', inputType: 'range', inputId: 'hypnoText-size-input' },
				{ elementType: 'input', inputType: 'text', inputId: 'hypnoText-color-picker' },
				{ elementType: 'button', inputType: 'button_toggle', inputId: 'hypnoText-randomize-button' },
				{ elementType: 'input', inputType: 'range', inputId: 'globalSpeed' },
				{ elementType: 'input', inputType: 'range', inputId: 'globalScale' },
				{ elementType: 'input', inputType: 'range', inputId: 'freq' },
				{ elementType: 'input', inputType: 'range', inputId: 'baseSpeed' },
				{ elementType: 'input', inputType: 'range', inputId: 'dirFlips' },
				{ elementType: 'input', inputType: 'range', inputId: 'concentric' },
				{ elementType: 'input', inputType: 'range', inputId: 'concentricSpeed' },
				{ elementType: 'input', inputType: 'range', inputId: 'noiseAngAmp' },
				{ elementType: 'input', inputType: 'range', inputId: 'noiseRadAmp' },
				{ elementType: 'input', inputType: 'range', inputId: 'noiseFreq' },
				{ elementType: 'input', inputType: 'range', inputId: 'noiseSpeed' },
				{ elementType: 'input', inputType: 'range', inputId: 'pulseAmp' },
				{ elementType: 'input', inputType: 'range', inputId: 'pulseFreq' },
				{ elementType: 'input', inputType: 'range', inputId: 'pulseSpeed' },
				{ elementType: 'input', inputType: 'range', inputId: 'hue' },
				{ elementType: 'input', inputType: 'range', inputId: 'sat' },
				{ elementType: 'input', inputType: 'range', inputId: 'val' },
				{ elementType: 'input', inputType: 'range', inputId: 'lineExp' },
				{ elementType: 'input', inputType: 'range', inputId: 'motionBlur' },
				{ elementType: 'input', inputType: 'range', inputId: 'superSample' },
			];

			let params = "?";
			inputList.forEach(function (inputInfo) {
				let inputElement;
				if (inputInfo.elementType === 'button' || inputInfo.elementType === 'textarea') {
					inputElement = document.getElementById(inputInfo.inputId);
				} else {
					inputElement = document.querySelector(`${inputInfo.elementType}[type='${inputInfo.inputType}'][id='${inputInfo.inputId}']`);
				}

				if (inputElement) {
					let value;
					if (inputInfo.inputType === 'button_toggle') {
						value = inputElement.classList.contains('active') ? 'true' : 'false';
					} else if (inputInfo.inputType === 'textarea') {
						value = encodeURIComponent(inputElement.value.replace(/\r?\n/g, '\r\n'));
					} else {
						value = encodeURIComponent(inputElement.value);
					}
					params += `${value}&`;
				}
			});
			const url = "https://diamond-dogg.github.io/spiral_generator_prealpha/viewer.html" + params;
			return url;
		}
	</script>
	<script>
	  const copyButton = document.getElementById('generateBtn');
	  copyButton.addEventListener('click', function() {
		const generatedUrl = generateURL();
		const generatedUrlField = document.getElementById('generatedUrl');

		// Copy URL to clipboard
		navigator.clipboard.writeText(generatedUrl).then(function() {
		  // Change button text to "Link Copied" for 1 second
		  copyButton.textContent = "Link Copied";
		  copyButton.style = "color: rgba(255, 255, 255, 0.75)";
		  setTimeout(() => {
			copyButton.textContent = "Generate Link";
			copyButton.style = "";
		  }, 1000);
		});
	  });
	</script>
</body>
</html>
